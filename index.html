<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<!-- FullCalendar core -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

<!-- Google Calendar plugin (API) -->
<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/google-calendar@6.1.11/index.global.min.js"></script>

<!-- iCal dependencies -->
<script src="https://cdn.jsdelivr.net/npm/ical.js@1.5.0/build/ical.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/icalendar@6.1.11/index.global.min.js"></script>

<style>
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  background: #0b0f14;
  color: #e5e7eb;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
}
#calendar {
  height: 100vh;
  padding: 12px;
  box-sizing: border-box;
}

/* イベント枠を完全フラットに */
.fc .fc-event,
.fc .fc-event-main,
.fc .fc-event-selected,
.fc .fc-event:hover,
.fc .fc-event.fc-event-dragging {
  border: none !important;
  box-shadow: none !important;
}

/* タイトル折返し */
.fc .fc-event-title {
  white-space: normal !important;
}
</style>
</head>

<body>
<div id="calendar"></div>

<script>
/* =========================
   Google API Key（使わないなら空でOK）
========================= */
const GOOGLE_API_KEY = "AIzaSyDZdH26P0tSEBRNnEa4rE9As7rcd924QJ4"; // 例: "AIzaSy...."

/* =========================
   カレンダー定義（iCal / API 混在）
========================= */
const CALENDARS = {
  /* ---------- Google API ---------- */
  "my-google": {
    type: "google",
    id: "yourname@gmail.com",
    visible: true,
    showTitle: true,
    showTime: true,
    color: "#2563eb"
  },

  /* ---------- iCal ---------- */
  "company-ical": {
    type: "ical",
    url: "https://calendar.google.com/calendar/ical/sugimoto%40shirogumi.co.jp/public/basic.ics",
    visible: true,
    showTitle: false,
    showTime: false,
    label: "予定あり",
    color: "#7c3aed"
  }
};

/* =========================
   eventSources 生成
========================= */
function buildEventSources() {
  const sources = [];

  Object.entries(CALENDARS).forEach(([key, cfg]) => {
    if (!cfg.visible) return;

    if (cfg.type === "google") {
      sources.push({
        id: key,
        googleCalendarId: cfg.id,
        color: cfg.color
      });
    }

    if (cfg.type === "ical") {
      sources.push({
        id: key,
        url: cfg.url,
        format: "ics",
        color: cfg.color
      });
    }
  });

  return sources;
}

/* =========================
   FullCalendar 初期化
========================= */
document.addEventListener("DOMContentLoaded", () => {
  const calendar = new FullCalendar.Calendar(
    document.getElementById("calendar"),
    {
      firstDay: 1, // 月曜始まり
      initialView: "timeGridWeek",
      height: "100%",
      expandRows: true,
      nowIndicator: true,
      slotMinTime: "06:00:00",
      slotMaxTime: "24:00:00",

      headerToolbar: {
        left: "prev,next today",
        center: "title",
        right: "timeGridWeek,dayGridMonth"
      },

      /* Google API（空なら無視される） */
      googleCalendarApiKey: GOOGLE_API_KEY || undefined,

      eventSources: buildEventSources(),

      /* =========================
         タイトル / 時間 表示制御
      ========================= */
      eventDidMount(info) {
        const srcId = info.event.source?.id;
        const cfg = CALENDARS[srcId];
        if (!cfg) return;

        /* タイトル制御 */
        if (cfg.showTitle === false) {
          const label = cfg.label ?? "";

          let titleEl =
            info.el.querySelector(".fc-event-title") ||
            info.el.querySelector(".fc-list-event-title");

          if (titleEl) {
            titleEl.textContent = label;
          } else {
            const frame =
              info.el.querySelector(".fc-event-main-frame") ||
              info.el.querySelector(".fc-event-main") ||
              info.el;

            const wrap = document.createElement("div");
            wrap.className = "fc-event-title-container";

            titleEl = document.createElement("div");
            titleEl.className = "fc-event-title";
            titleEl.textContent = label;

            wrap.appendChild(titleEl);
            frame.appendChild(wrap);
          }
        }

        /* 時間制御 */
        if (cfg.showTime === false) {
          info.el
            .querySelectorAll(".fc-event-time, .fc-list-event-time")
            .forEach(el => el.textContent = "");
        }
      }
    }
  );

  calendar.render();
});
</script>
</body>
</html>
